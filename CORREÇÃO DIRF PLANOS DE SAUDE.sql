
CREATE TABLE dbo._DADOSDIRF (
	EMP VARCHAR(2),
	FILIAL VARCHAR(2),
	MATRICULA VARCHAR(6),
	VERBA VARCHAR(3),
	ANO VARCHAR(4),
	NOME VARCHAR(50),
	FORNECEDOR VARCHAR(3),
	CNPJ VARCHAR(14),
	DESCRICAO VARCHAR(130)
)
/*%%%%%%%%%%%%%%%%*/

SELECT * FROM _DADOSDIRF

DELETE FROM _DADOSDIRF

DROP TABLE _DADOSDIRF

/*%%%%%%%%%%%%%%%%*/

-- Importar dados
bulk insert _DADOSDIRF from 'C:\A\DADOSDIRF.csv' with (fieldterminator = ';', rowterminator = '\n', firstrow = 1, codepage = 'acp')

/*%%%%%%%%%%%%%%%%*/

SELECT * FROM RCS020 WHERE  RCS_ANO = '2019'  AND RCS_MAT = '000184 ' AND RCS_CPFCGC = '64277247000132' AND  RCS_VERBA = '406' AND RCS_FILIAL = '02' --AND RCS_MAT = '000184'

-- ATUALIZA A TABELA DA DIRF PARA SEPARAR OS PLANOS DE SAUDE  
UPDATE RCS030 SET RCS_CPFCGC = (SELECT CNPJ FROM _DADOSDIRF WHERE EMP+FILIAL+MATRICULA = '03'+RCS_FILIAL+RCS_MAT ),  
RCS_DESCRI = (SELECT DESCRICAO FROM _DADOSDIRF WHERE EMP+FILIAL+MATRICULA = '03'+RCS_FILIAL+RCS_MAT )
WHERE 
RCS_ANO = '2019'
--AND RCS_MAT = '000184'
AND RCS_VERBA = '198'
AND RCS_FILIAL = '01'
AND D_E_L_E_T_ <> '*'

406
198
436

-- PROCURA VERBA FANTANTE NA TABELA _DADOSDIRF
SELECT * FROM RCS030 WHERE  RCS_ANO = '2019' AND RCS_VERBA = '198'  AND RCS_FILIAL = '01' AND RCS_MAT NOT IN (
	SELECT MATRICULA FROM _DADOSDIRF WHERE EMP = '03' AND FILIAL = '01'
)

406
198
436

--IDENTIFICA FUNCIONARIO 
SELECT * FROM SRA020 WHERE RA_MAT = '000017'

--INSERE FUNCIONARIO 
INSERT INTO _DADOSDIRF 
VALUES  ('02','01','000017','436','2019','URIAS ALEXANDRE GONCALVES     ','001','17774738000109','A.MEDICA CONSULTAS             / RAZAO SOCIAL: UNIMED UBERABA COOPERATIVA DE TRABALHO MEDICO LTDA/ CNPJ: 17774738000109' )



/*UNIODONTO ----------------------------*/
UPDATE RCS020 SET RCS_CPFCGC ='17333055000116' , RCS_DESCRI = 'A.ODONTOLOGICA                 / RAZAO SOCIAL: UNIODONTO UBERABA / CNPJ: 17.333.055/0001-16'
WHERE  RCS_ANO = '2019' AND RCS_VERBA = '436'




SELECT * FROM RCS020 WHERE  RCS_ANO = '2019'  AND RCS_VERBA = '436'AND RCS_MAT = '000123'    


SELECT  RD_MAT, RA_CIC ,SUM(RD_VALOR) AS VALOR 
FROM SRD030
INNER JOIN SRA030 ON RA_FILIAL+RA_MAT = RD_FILIAL+RD_MAT
WHERE RD_PERIODO BETWEEN '201812' AND '201911'
AND RD_PD = '436'
--AND RD_FILIAL = '02'
GROUP BY RD_MAT , RA_CIC
ORDER BY RD_MAT


SELECT * FROM _DADOSDIRF WHERE EMP ='02' AND VERBA = '198'
AND MATRICULA IN (
'000012',
'000017',
'000035',
'000047',
'000059',
'000073',
'000074',
'000081')
ORDER BY MATRICULA



SELECT * FROM SRA030

406
198
436

SELECT * FROM SRV010 WHERE RV_COD  IN (
'401','402')



SELECT DISTINCT(RV_COD) , RV_DESC, RV_DIRF, RV_DESCDET 
FROM SRV020 
INNER JOIN SRD020 ON RD_PD = RV_COD AND RD_PERIODO BETWEEN '201812' AND '201911' 
WHERE  ( RV_DESCDET LIKE '%SEG%' OR RV_DESC LIKE '%SEG%') 

SELECT * FROM SRV050 WHERE RV_COD IN (
'768')



SELECT  C7_VALIPI , C7_IPI, C7_TPFRETE, C7_DETALHE, * FROM SC7010 WHERE C7_EMISSAO > '20200101' AND 

SELECT * FROM SC1010 WHERE C1_EMISSAO > '20200101' AND C1_NUM = '012338'


SELECT * FROM SC7010 	WHERE C7_NUM = '022823'

SELECT * FROM SC1010 WHERE C1_EMISSAO > '20200101'



SELECT RV_DESC, RD_PD, RA_FILIAL ,RA_MAT , RA_CIC , SUM(RD_VALOR)
FROM SRD030 RD
INNER JOIN SRV030 RV ON RV_COD = RD_PD AND RV.D_E_L_E_T_ <> '*'
INNER JOIN SRA030 RA ON RA_MAT = RD_MAT AND RD_FILIAL = RA_FILIAL AND RA.D_E_L_E_T_ <> '*'
WHERE RD_PD IN ('198','436') 
AND RD_PERIODO BETWEEN '201812' AND '201911'
AND RD.D_E_L_E_T_ <> '*'
GROUP BY RV_DESC, RD_PD, RA_FILIAL ,RA_MAT , RA_CIC 


SELECT RD_MAT, RD_VALOR, * FROM SRD030 WHERE RD_PD = '436' AND RD_PERIODO BETWEEN  '201812' AND '201911'  AND D_E_L_E_T_ <> '*'

SELECT * FROM RCS030 WHERE RCS_ANO = '2019'








