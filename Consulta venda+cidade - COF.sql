
-- SELECT DE QUAIS CIDADES HOUVE VENDA NOS ULTIMOS TRES MESES PARA 'COF'
----
create table #tmp
    (muni varchar(90) null,
    cli varchar (9) null)     
Insert into #tmp (muni,cli)
	 SELECT A1.A1_MUN AS MUN, F2.F2_CLIENT
	 FROM SF2020 F2
	 INNER JOIN SA1010 A1 ON F2.F2_CLIENT = A1.A1_COD AND F2.F2_LOJA = A1.A1_LOJA 
	 WHERE F2.F2_EMISSAO > '20160401'
	 AND F2.D_E_L_E_T_ <> '*'
	 AND A1.D_E_L_E_T_ <> '*'
	 AND A1.A1_X_CT = 'COF'	 
	 GROUP BY A1.A1_MUN,F2.F2_CLIENT	 
	 
create table #tmp2
    (muni varchar(90) null, QNT INT NULL)	
Insert into #tmp2 (muni,QNT)     
   SELECT  muni,  count(muni) from #tmp group by muni ;	  
	 
	 --drop table #tmp2
--- 

SELECT A1.A1_MUN AS 'CIDADE', A1.A1_EST, SUM(F2.F2_VOLUME1) AS VOLUME	, #tmp2.QNT AS 'QUANTIDADE_CLIENTES'
FROM SF2010 F2 
INNER JOIN SA1010 A1 ON F2.F2_CLIENT = A1.A1_COD AND F2.F2_LOJA = A1.A1_LOJA
INNER JOIN #tmp2 ON muni = A1.A1_MUN
WHERE F2.F2_EMISSAO > '20160401'
AND A1.A1_X_CT = 'COF'
AND A1.D_E_L_E_T_ <> '*'
AND F2.D_E_L_E_T_ <> '*'
GROUP BY A1.A1_MUN, A1.A1_EST ,#tmp2.QNT

UNION 

SELECT A1.A1_MUN AS 'CIDADE', A1.A1_EST, SUM(F2.F2_VOLUME1) AS 'VOLUME'	, #tmp2.QNT AS 'QUANTIDADE_CLIENTES'
FROM SF2020 F2 
INNER JOIN SA1010 A1 ON F2.F2_CLIENT = A1.A1_COD AND F2.F2_LOJA = A1.A1_LOJA
INNER JOIN #tmp2 ON muni = A1.A1_MUN
WHERE F2.F2_EMISSAO > '20160401'
AND A1.A1_X_CT = 'COF'
AND A1.D_E_L_E_T_ <> '*'
AND F2.D_E_L_E_T_ <> '*'
GROUP BY A1.A1_MUN, A1.A1_EST , #tmp2.QNT
order by A1.A1_MUN
---

select COUNT(*), A1.A1_MUN  from SA1010 A1 WHERE A1.A1_MUN LIKE '%PATROCINIO%'  AND A1.A1_X_CT = 'COF' AND A1.D_E_L_E_T_ <> '*' GROUP BY A1.A1_MUN

SELECT A1.A1_MUN, F2.F2_CLIENT
FROM SF2020 F2 
INNER JOIN SA1010 A1 ON F2.F2_CLIENT = A1.A1_COD AND F2.F2_LOJA = A1.A1_LOJA
WHERE A1.A1_MUN LIKE '%PATROCINIO%' 
AND F2.F2_EMISSAO > '20160401'
 AND A1.A1_X_CT = 'COF'
  AND A1.D_E_L_E_T_ <> '*' 
  GROUP BY A1.A1_MUN, F2.F2_CLIENT
-----


SELECT A1.A1_MUN,A1.A1_EST, COUNT(A1.A1_MUN)AS QUANTIDADE  
FROM SA1010 A1 
WHERE A1.A1_X_CT = 'COF'
AND A1.D_E_L_E_T_ <> '*'
GROUP BY A1.A1_MUN , A1.A1_EST
ORDER BY A1.A1_EST,A1.A1_MUN