//DECLARE @DTBASE CHAR 
//SET @DTBASE = '20200207'

SELECT * FROM SA3010

--/////////////////////////// DISTRIBUIDORA 

SELECT A1_COD CODIGO,A1_NOME NOME , A3_NOME,A1_LOJA LOJA, A1_MUN CIDADE, A1_EST UF, A1_LC LIMITE, A1_RISCO RISCO, SUM(E1_SALDO) AS 'TOMADO' 
--,(SELECT SUM(E1_VALOR) FROM SE1010 WHERE E1_VENCREA < '20181212'  AND E1_CLIENTE = A1_COD AND E1_LOJA = A1_LOJA  AND E1_BAIXA = '' AND D_E_L_E_T_ <> '*') AS VENCIDO 
,(SELECT SUM(E1_SALDO) FROM SE1010 WHERE E1_VENCREA < '20200524'  
	AND E1_CLIENTE = A1_COD 
    AND E1_LOJA = A1_LOJA   
    AND E1_SALDO <> 0  
    AND D_E_L_E_T_ <> '*') AS VENCIDO 
FROM SE1010 SE1 

INNER JOIN SA1010 SA1 ON A1_COD = SE1.E1_CLIENTE AND A1_LOJA = SE1.E1_LOJA
INNER JOIN SA3010 SA3 ON SA1.A1_VEND = SA3.A3_COD
WHERE 
SE1.E1_CLIENTE IN 
	( SELECT D2_CLIENTE FROM SD2010 WHERE /* D2_EMISSAO BETWEEN '20100101' AND '20181231' AND */  D_E_L_E_T_ <> '*' GROUP BY D2_CLIENTE  )
--AND SE1.E1_BAIXA = ''
AND SE1.E1_SALDO <> 0
AND SE1.D_E_L_E_T_ <>'*'
AND SA1.D_E_L_E_T_ <> '*'
GROUP BY A1_COD,A1_NOME,A3_NOME,A1_LOJA,A1_MUN,A1_EST, A1_LC, A1_RISCO
ORDER BY A1_COD

--/////////////////////////// DERIVADOS 

SELECT A1_COD CODIGO,A1_NOME NOME,A3_NOME,A1_LOJA LOJA, A1_MUN CIDADE, A1_EST UF, A1_LC LIMITE, A1_RISCO RISCO, SUM(E1_SALDO) AS 'TOMADO' 
--,(SELECT SUM(E1_VALOR) FROM SE1020 WHERE E1_VENCREA < '20181212'  AND E1_CLIENTE = A1_COD AND E1_LOJA = A1_LOJA  AND E1_BAIXA = '' AND D_E_L_E_T_ <> '*') AS VENCIDO 
,(SELECT SUM(E1_SALDO) FROM SE1020 WHERE E1_VENCREA < '20200524'  AND E1_CLIENTE = A1_COD AND E1_LOJA = A1_LOJA  AND E1_SALDO<>0 AND D_E_L_E_T_ <> '*') AS VENCIDO 
FROM SE1020 SE1
INNER JOIN SA1010 SA1 ON A1_COD = SE1.E1_CLIENTE AND A1_LOJA = SE1.E1_LOJA
INNER JOIN SA3010 ON A1_VEND = A3_COD
WHERE SE1.E1_CLIENTE IN 
	( SELECT D2_CLIENTE FROM SD2020 WHERE /* D2_EMISSAO BETWEEN '20170701' AND '20180731' AND */ D_E_L_E_T_ <> '*' GROUP BY D2_CLIENTE  )
--AND  SE1.E1_BAIXA = ''
AND SE1.E1_SALDO <>0
AND SE1.D_E_L_E_T_ <>'*'
AND SA1.D_E_L_E_T_ <> '*'
GROUP BY A1_COD,A1_NOME,A3_NOME,A1_LOJA,A1_MUN,A1_EST, A1_LC, A1_RISCO
ORDER BY A1_COD


--/////////////////////////// TRR GOAIS 

SELECT A1_COD CODIGO,A1_NOME NOME,A3_NOME,A1_LOJA LOJA, A1_MUN CIDADE, A1_EST UF, A1_LC LIMITE, A1_RISCO RISCO, SUM(E1_VALOR) AS 'TOMADO' 
,(SELECT SUM(E1_VALOR) FROM SE1050 WHERE E1_VENCREA < '20200524'  AND E1_CLIENTE = A1_COD AND E1_LOJA = A1_LOJA  AND E1_BAIXA = '' AND D_E_L_E_T_ <> '*') AS VENCIDO 
FROM SE1050 SE1
INNER JOIN SA1010 SA1 ON A1_COD = SE1.E1_CLIENTE AND A1_LOJA = SE1.E1_LOJA
INNER JOIN SA3010 ON A1_VEND = A3_COD
WHERE SE1.E1_CLIENTE IN 
	( SELECT D2_CLIENTE FROM SD2050 WHERE /* D2_EMISSAO BETWEEN '20170701' AND '20180731' AND */ D_E_L_E_T_ <> '*' GROUP BY D2_CLIENTE  )
AND  SE1.E1_BAIXA = ''
AND SE1.E1_SALDO <>0
AND SE1.D_E_L_E_T_ <>'*'
AND SA1.D_E_L_E_T_ <> '*'
GROUP BY A1_COD,A1_NOME,A3_NOME,A1_LOJA,A1_MUN,A1_EST, A1_LC, A1_RISCO
ORDER BY A1_COD

--///////////////////////////// 

--SELECT sum(E1_VALOR) FROM SE1020 WHERE E1_CLIENTE = '006130' AND E1_LOJA='01' AND D_E_L_E_T_ <>'*' AND E1_BAIXA = '' AND E1_VENCREA < '20180806'
--SELECT * FROM SE1010 WHERE E1_CLIENTE = '001774' AND E1_BAIXA = '' AND D_E_L_E_T_ <> '*'
--Select * from SD2010 WHERE D2_PEDIDO ='029777'
--SELECT * from SF2010 where F2_DOC ='000028652' AND F2_CLIENTE='008123'